<!DOCTYPE html>
<html th:lang="${#locale.language}" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dosya Yönetimi</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<div class="navbar">
    <a href="/" class="logo">Dosya Yönetimi</a>
    <div class="menu">
        <div class="language-selector">
            <select onchange="changeLanguage(this.value)">
                <option value="tr" th:selected="${#locale.toString() == 'tr'}" th:text="#{language.tr}">Türkçe</option>
                <option value="en" th:selected="${#locale.toString() == 'en'}" th:text="#{language.en}">English</option>
            </select>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()">
            <i class="fas fa-sun" id="theme-icon"></i>
            <span id="theme-text" th:text="#{app.theme.light}">Tema Değiştir</span>
        </button>
        <div sec:authorize="isAuthenticated()" class="auth-buttons">
            <a href="/upload" th:text="#{nav.upload}">Dosya Yükle</a>
            <form th:action="@{/logout}" method="post" class="logout-form">
                <button type="submit" class="logout-button" th:text="#{nav.logout}">Çıkış Yap</button>
            </form>
        </div>
    </div>
</div>

<div class="content">
    <!-- Klasör yolu -->
    <div class="folder-path">
        <a href="/folders" class="path-item">
            <i class="fas fa-home"></i> Ana Dizin
        </a>
        <span th:if="${currentFolder.parentFolder != null}">
            <i class="fas fa-chevron-right"></i>
            <a th:href="@{/folders/{id}(id=${currentFolder.parentFolder.id})}" 
               th:text="${currentFolder.parentFolder.name}" class="path-item">
                Üst Klasör
            </a>
        </span>
        <i class="fas fa-chevron-right"></i>
        <span th:text="${currentFolder.name}" class="current-folder">Mevcut Klasör</span>
    </div>

    <div class="folder-actions">
        <button onclick="showCreateFolderModal()" class="btn btn-primary">
            <i class="fas fa-folder-plus"></i> Yeni Klasör
        </button>
        <button onclick="showUploadModal()" class="btn btn-primary">
            <i class="fas fa-upload"></i> Dosya Yükle
        </button>
    </div>

    <!-- Alt klasörler -->
    <div class="folders-grid" th:if="${!subFolders.empty}">
        <div th:each="folder : ${subFolders}" class="folder-item">
            <a th:href="@{/folders/{id}(id=${folder.id})}" class="folder-link">
                <i class="fas fa-folder"></i>
                <span th:text="${folder.name}">Klasör Adı</span>
            </a>
            <div class="folder-actions">
                <form th:action="@{/folders/{id}/delete(id=${folder.id})}" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-danger btn-sm" 
                            onclick="return confirm('Bu klasörü silmek istediğinizden emin misiniz?')">
                        <i class="fas fa-trash"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Dosyalar -->
    <div class="files-table-container" th:if="${!files.empty}">
        <table class="files-table">
            <thead>
                <tr>
                    <th th:text="#{table.filename}">Dosya Adı</th>
                    <th th:text="#{table.size}">Boyut</th>
                    <th th:text="#{table.upload.date}">Yükleme Tarihi</th>
                    <th th:text="#{table.actions}">İşlemler</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="file : ${files}">
                    <td th:text="${file.originalFilename}"></td>
                    <td th:text="${#numbers.formatDecimal(file.size / 1024, 0, 2) + ' KB'}"></td>
                    <td th:text="${#temporals.format(file.uploadDate, 'dd/MM/yyyy HH:mm')}"></td>
                    <td class="action-buttons">
                        <a th:href="@{/uploads/{id}(id=${file.id})}" 
                           class="btn btn-primary btn-sm" download th:text="#{table.download}">İndir</a>
                        <button class="btn btn-primary btn-sm" 
                                th:onclick="'showShareModal(\'' + ${file.fileName} + '\')'" 
                                th:text="#{table.share}">Paylaş</button>
                        <form th:action="@{/delete/{id}(id=${file.id})}" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-danger btn-sm" 
                                    th:onclick="'return confirm(\'' + #{table.delete.confirm} + '\')'"
                                    th:text="#{table.delete}">Sil</button>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div th:if="${subFolders.empty and files.empty}" class="empty-state">
        <h2>Bu klasör boş</h2>
        <p>Yeni klasör oluşturun veya dosya yükleyin.</p>
    </div>
</div>

<!-- Yeni Klasör Oluşturma Modal -->
<div id="createFolderModal" class="modal">
    <div class="modal-content">
        <h3>Yeni Klasör</h3>
        <form th:action="@{/folders/create}" method="post">
            <input type="hidden" name="parentId" th:value="${currentFolder.id}">
            <input type="text" name="name" placeholder="Klasör Adı" required>
            <div class="modal-buttons">
                <button type="button" class="btn btn-danger" onclick="hideCreateFolderModal()">İptal</button>
                <button type="submit" class="btn btn-primary">Oluştur</button>
            </div>
        </form>
    </div>
</div>

<!-- Dosya Yükleme Modal -->
<div id="uploadModal" class="modal">
    <div class="modal-content">
        <h3>Dosya Yükle</h3>
        <form th:action="@{/upload}" method="post" enctype="multipart/form-data">
            <input type="hidden" name="folderId" th:value="${currentFolder.id}">
            <div class="file-input-container">
                <input type="file" name="file" id="file" class="file-input" required>
                <label for="file" class="file-label">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span th:text="#{upload.select}">Dosya Seç veya Sürükle & Bırak</span>
                </label>
                <div id="file-name" class="file-name"></div>
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn btn-danger" onclick="hideUploadModal()">İptal</button>
                <button type="submit" class="btn btn-primary">Yükle</button>
            </div>
        </form>
    </div>
</div>

<!-- Paylaşım Modal -->
<div id="shareModal" class="modal">
    <div class="modal-content">
        <h3 th:text="#{share.title}">Dosya Paylaş</h3>
        <form action="/share" method="post">
            <input type="hidden" id="shareFilename" name="filename">
            <input type="email" name="email" th:placeholder="#{share.email}" required>
            <div class="modal-buttons">
                <button type="button" class="btn btn-danger" onclick="hideShareModal()" th:text="#{share.cancel}">İptal</button>
                <button type="submit" class="btn btn-primary" th:text="#{share.button}">Paylaş</button>
            </div>
        </form>
    </div>
</div>

<script th:inline="javascript">
    // Dil değiştirme fonksiyonu
    function changeLanguage(lang) {
        const url = new URL(window.location.href);
        url.searchParams.set('lang', lang);
        window.location.href = url.toString();
    }

    // Tema tercihi için localStorage kullan
    function setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        
        const themeIcon = document.getElementById('theme-icon');
        const themeText = document.getElementById('theme-text');
        
        if (theme === 'dark') {
            themeIcon.className = 'fas fa-moon';
            themeText.textContent = /*[[#{app.theme.dark}]]*/ 'Açık Mod';
        } else {
            themeIcon.className = 'fas fa-sun';
            themeText.textContent = /*[[#{app.theme.light}]]*/ 'Koyu Mod';
        }
    }

    function toggleTheme() {
        const currentTheme = localStorage.getItem('theme') || 'light';
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        setTheme(newTheme);
    }

    // Sayfa yüklendiğinde tema tercihini kontrol et
    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme') || 'light';
        setTheme(savedTheme);

        // Dosya seçildiğinde dosya adını göster
        const fileInput = document.getElementById('file');
        const fileName = document.getElementById('file-name');
        
        if (fileInput && fileName) {
            fileInput.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    fileName.textContent = this.files[0].name;
                } else {
                    fileName.textContent = '';
                }
            });
        }
    });

    // Modal fonksiyonları
    function showCreateFolderModal() {
        document.getElementById('createFolderModal').style.display = 'flex';
    }

    function hideCreateFolderModal() {
        document.getElementById('createFolderModal').style.display = 'none';
    }

    function showUploadModal() {
        document.getElementById('uploadModal').style.display = 'flex';
    }

    function hideUploadModal() {
        document.getElementById('uploadModal').style.display = 'none';
    }

    function showShareModal(filename) {
        document.getElementById('shareModal').style.display = 'flex';
        document.getElementById('shareFilename').value = filename;
    }

    function hideShareModal() {
        document.getElementById('shareModal').style.display = 'none';
    }

    // Modal dışına tıklandığında modalı kapat
    window.onclick = function(event) {
        var modals = document.getElementsByClassName('modal');
        for (var modal of modals) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    }
</script>

<style>
.folder-path {
    padding: 1rem;
    background-color: var(--bg-secondary);
    border-radius: 8px;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.path-item {
    color: var(--text-primary);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.path-item:hover {
    text-decoration: underline;
}

.current-folder {
    color: var(--text-secondary);
}

.folders-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1rem;
    padding: 1rem;
    margin-bottom: 2rem;
}

.folder-item {
    background-color: var(--bg-secondary);
    border-radius: 8px;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: all 0.3s ease;
}

.folder-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.folder-link {
    text-decoration: none;
    color: var(--text-primary);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.folder-link i {
    font-size: 2rem;
    color: #ffd700;
}

.folder-actions {
    margin: 1rem 0;
    display: flex;
    gap: 0.5rem;
}

.btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
}

.files-table-container {
    margin-top: 2rem;
    background-color: var(--bg-secondary);
    border-radius: 8px;
    overflow: hidden;
}

.empty-state {
    text-align: center;
    padding: 3rem;
    background-color: var(--bg-secondary);
    border-radius: 8px;
    margin-top: 2rem;
}

.empty-state h2 {
    color: var(--text-primary);
    margin-bottom: 1rem;
}

.empty-state p {
    color: var(--text-secondary);
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--modal-bg);
    justify-content: center;
    align-items: center;
}

.modal-content {
    background-color: var(--bg-secondary);
    padding: 2rem;
    border-radius: 8px;
    width: 90%;
    max-width: 400px;
}

.modal-content input {
    width: 100%;
    padding: 0.5rem;
    margin: 1rem 0;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    background-color: var(--input-bg);
    color: var(--text-primary);
}

.modal-buttons {
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
    margin-top: 1rem;
}

.file-input-container {
    margin-bottom: 1.5rem;
}

.file-input {
    display: none;
}

.file-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    padding: 2rem;
    border: 2px dashed var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.file-label:hover {
    border-color: var(--btn-primary-bg);
    color: var(--btn-primary-bg);
}

.file-label i {
    font-size: 2rem;
}

.file-name {
    margin-top: 1rem;
    color: var(--text-primary);
    font-size: 0.9rem;
    text-align: center;
}
</style>

</body>
</html> 